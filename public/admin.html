<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XFlix â€” Admin</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body class="admin-body">

  <nav class="admin-nav">
    <a class="admin-brand" href="/">ğŸ¬ XFlix</a>
    <span class="admin-title">Panneau d'administration</span>
    <div class="admin-nav-right">
      <span id="adminUser" class="admin-user-badge"></span>
      <a href="/" class="btn btn-sm">â† Site</a>
      <button class="btn btn-sm btn-danger" id="logoutBtn">DÃ©connexion</button>
    </div>
  </nav>

  <div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <nav class="admin-sidenav">
        <button class="sidenav-item active" data-tab="dashboard">ğŸ“Š Tableau de bord</button>
        <button class="sidenav-item" data-tab="users">ğŸ‘¥ Utilisateurs</button>
        <button class="sidenav-item" data-tab="media">ğŸ¬ MÃ©dias</button>
        <button class="sidenav-item" data-tab="tools">ğŸ”§ Outils</button>
        <button class="sidenav-item" data-tab="settings">âš™ï¸ ParamÃ¨tres</button>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="admin-main">

      <!-- DASHBOARD -->
      <section id="tab-dashboard" class="admin-tab active">
        <h2>Tableau de bord</h2>
        <div class="stats-grid" id="dashStats">
          <div class="stat-card"><div class="stat-val" id="st-users">â€”</div><div class="stat-lbl">Utilisateurs</div></div>
          <div class="stat-card"><div class="stat-val" id="st-media">â€”</div><div class="stat-lbl">MÃ©dias</div></div>
          <div class="stat-card"><div class="stat-val" id="st-comments">â€”</div><div class="stat-lbl">Commentaires</div></div>
          <div class="stat-card"><div class="stat-val" id="st-reactions">â€”</div><div class="stat-lbl">RÃ©actions</div></div>
        </div>
      </section>

      <!-- USERS -->
      <section id="tab-users" class="admin-tab">
        <div class="tab-header">
          <h2>Utilisateurs</h2>
          <input type="search" id="userSearch" class="input" placeholder="Rechercherâ€¦" style="max-width:250px">
        </div>
        <div class="table-wrap">
          <table class="admin-table">
            <thead><tr>
              <th>ID</th><th>Nom</th><th>Email</th><th>RÃ´le</th>
              <th>DerniÃ¨re connexion</th><th>CrÃ©Ã© le</th><th>Actions</th>
            </tr></thead>
            <tbody id="usersBody"></tbody>
          </table>
        </div>
        <div class="pagination" id="usersPagination"></div>
      </section>

      <!-- MEDIA -->
      <section id="tab-media" class="admin-tab">
        <h2>MÃ©dias &amp; Scan</h2>

        <div class="admin-card">
          <h3>Scanner les mÃ©dias</h3>
          <p class="muted">Lance un scan du dossier /home/coder/OF et indexe les nouveaux fichiers.</p>
          <button class="btn btn-primary" id="scanBtn">â–¶ DÃ©marrer le scan</button>
          <button class="btn btn-danger hidden" id="scanCancelBtn">â¹ Annuler</button>
          <div id="scanLog" class="log-box hidden"></div>
        </div>

        <div class="admin-card">
          <h3>GÃ©nÃ©rer les miniatures manquantes</h3>
          <p class="muted">GÃ©nÃ¨re les thumbnails ffmpeg/sharp pour les mÃ©dias qui n'en ont pas encore.</p>
          <button class="btn btn-primary" id="batchThumbBtn">â–¶ GÃ©nÃ©rer les miniatures</button>
          <button class="btn btn-danger hidden" id="batchThumbCancelBtn">â¹ Annuler</button>
          <div id="thumbProgress" class="progress-wrap hidden">
            <div class="progress-bar"><div class="progress-fill" id="thumbFill"></div></div>
            <span id="thumbLabel"></span>
          </div>
        </div>

        <div class="admin-card">
          <h3>ğŸ—‘ Vider la base de donnÃ©es</h3>
          <p class="muted">Supprime tous les mÃ©dias et performers indexÃ©s. Les fichiers sur disque ne sont <strong>pas</strong> supprimÃ©s.</p>
          <button class="btn btn-danger" id="clearDbBtn">ğŸ—‘ Vider la BDD</button>
        </div>
      </section>

      <!-- TOOLS -->
      <section id="tab-tools" class="admin-tab">
        <h2>Outils</h2>

        <div class="admin-card">
          <h3>ğŸ–¼ Navigateur de mÃ©dias</h3>
          <p class="muted">Parcourez, filtrez et supprimez des fichiers spÃ©cifiques.</p>
          <div class="mb-filters">
            <select id="mbPerformer" class="input" style="max-width:220px"><option value="">Tous les performers</option></select>
            <select id="mbType" class="input" style="max-width:140px">
              <option value="">Tous les types</option>
              <option value="photo">ğŸ–¼ Photos</option>
              <option value="video">ğŸ¬ VidÃ©os</option>
            </select>
            <input id="mbSearch" class="input" placeholder="Nom du fichierâ€¦" style="flex:1;min-width:160px">
            <button class="btn btn-primary" id="mbLoadBtn">ğŸ” Rechercher</button>
          </div>
          <div class="mb-toolbar hidden" id="mbToolbar">
            <button class="btn btn-sm" id="mbSelectAllBtn">Tout sÃ©lectionner</button>
            <button class="btn btn-sm" id="mbUnselectBtn">âœ— DÃ©cocher</button>
            <span id="mbSelCount" class="dup-sel-count">0 sÃ©lectionnÃ©(s)</span>
            <span class="dup-toolbar-sep"></span>
            <button class="btn btn-sm btn-danger" id="mbDeleteBtn" disabled>ğŸ—‘ Supprimer la sÃ©lection</button>
          </div>
          <div id="mbGrid" class="mb-grid hidden"></div>
          <div id="mbPagination" class="pagination" style="margin-top:14px"></div>
          <div id="mbProgress" class="progress-wrap hidden" style="margin-top:10px">
            <div class="progress-bar"><div class="progress-fill" id="mbFill"></div></div>
            <span id="mbLabel"></span>
          </div>
        </div>

        <div class="admin-card">
          <h3>DÃ©tection des doublons</h3>
          <p class="muted">Regroupe les fichiers de mÃªme taille et hash partiel (64 KB).</p>
          <div class="form-row" style="margin-bottom:14px;align-items:center;gap:8px">
            <label class="checkbox-label"><input type="radio" name="dupType" value="all"   checked> Tous</label>
            <label class="checkbox-label"><input type="radio" name="dupType" value="video"> ğŸ¬ VidÃ©os uniquement</label>
            <label class="checkbox-label"><input type="radio" name="dupType" value="photo"> ğŸ–¼ Photos uniquement</label>
          </div>
          <button class="btn btn-primary" id="dupScanBtn">ğŸ” Analyser les doublons</button>
          <button class="btn btn-danger hidden" id="dupCancelBtn">â¹ Annuler</button>
          <div id="dupProgress" class="progress-wrap hidden">
            <div class="progress-bar"><div class="progress-fill" id="dupFill"></div></div>
            <span id="dupLabel"></span>
          </div>
          <div id="dupResults" class="dup-results hidden"></div>
        </div>

        <div class="admin-card">
          <h3>âœ‚ï¸ Supprimer les courtes vidÃ©os</h3>
          <p class="muted">Supprime toutes les vidÃ©os dont la durÃ©e connue est infÃ©rieure au seuil. Les vidÃ©os sans durÃ©e (non encore enrichies) sont ignorÃ©es.</p>
          <div class="form-row" style="margin-bottom:14px;align-items:center;gap:16px;flex-wrap:wrap">
            <label style="display:flex;align-items:center;gap:8px;font-size:.95rem">
              DurÃ©e max :
              <input type="number" id="shortVidMinutes" class="input" value="2" min="1" max="120" style="width:72px"> min
            </label>
          </div>
          <div class="btn-row" style="margin-bottom:12px">
            <button class="btn btn-primary" id="shortVidPreviewBtn">ğŸ‘ AperÃ§u</button>
            <button class="btn btn-danger" id="shortVidDeleteBtn">ğŸ—‘ Supprimer</button>
            <button class="btn btn-danger hidden" id="shortVidCancelBtn">â¹ Annuler</button>
          </div>
          <div id="shortVidProgress" class="progress-wrap hidden">
            <div class="progress-bar"><div class="progress-fill" id="shortVidFill"></div></div>
            <span id="shortVidLabel"></span>
          </div>
          <div id="shortVidLog" class="log-box hidden"></div>
        </div>

        <div class="admin-card">
          <h3>ğŸ§¹ Nettoyage des mÃ©dias</h3>
          <p class="muted">DÃ©tecte les entrÃ©es DB sans fichier sur disque, les fichiers non indexÃ©s et les miniatures orphelines.</p>
          <div class="form-row" style="margin-bottom:14px">
            <label class="checkbox-label">
              <input type="checkbox" id="cleanDryRun" checked>
              Simulation (dry-run) â€” aucune modification
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="cleanVerbose">
              Mode verbeux (afficher chaque fichier)
            </label>
          </div>
          <div class="btn-row" style="margin-bottom:12px">
            <button class="btn btn-warning" id="cleanBtn">ğŸ§¹ Analyser &amp; Nettoyer</button>
            <button class="btn btn-danger hidden" id="cleanCancelBtn">â¹ Annuler</button>
          </div>
          <div id="cleanProgress" class="progress-wrap hidden">
            <div class="progress-bar"><div class="progress-fill" id="cleanFill"></div></div>
            <span id="cleanPhaseLabel"></span>
          </div>
          <div id="cleanLog" class="log-box hidden"></div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="tab-settings" class="admin-tab">
        <h2>ParamÃ¨tres</h2>

        <div class="admin-card">
          <h3>Inscription</h3>
          <label class="checkbox-label">
            <input type="checkbox" id="allowReg">
            Autoriser les nouvelles inscriptions
          </label>
          <button class="btn btn-primary" id="saveRegBtn" style="margin-top:12px">ğŸ’¾ Enregistrer</button>
        </div>

        <div class="admin-card">
          <h3>Configuration SMTP (envoi d'emails)</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Serveur SMTP</label>
              <input class="input" id="smtpHost" placeholder="smtp.gmail.com">
            </div>
            <div class="form-group">
              <label>Port</label>
              <input class="input" id="smtpPort" placeholder="587" type="number">
            </div>
            <div class="form-group">
              <label>Utilisateur</label>
              <input class="input" id="smtpUser" placeholder="you@gmail.com">
            </div>
            <div class="form-group">
              <label>Mot de passe</label>
              <input class="input" id="smtpPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <div class="form-group">
              <label>Adresse expÃ©diteur</label>
              <input class="input" id="smtpFrom" placeholder="XFlix <no-reply@example.com>">
            </div>
            <div class="form-group">
              <label class="checkbox-label" style="margin-top:28px">
                <input type="checkbox" id="smtpSecure"> SSL direct (port 465)
              </label>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" id="saveSmtpBtn">ğŸ’¾ Enregistrer</button>
            <button class="btn" id="testSmtpBtn">ğŸ“§ Tester la connexion</button>
          </div>
          <div id="smtpTestResult" class="alert hidden"></div>
        </div>
      </section>

    </main>
  </div>

  <script src="/js/admin.js"></script>
</body>
</html>
